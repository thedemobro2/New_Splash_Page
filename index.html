<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RL-80 • The Rebel Library</title>
  <style>
    :root{
      --phosphor:#2bff63;
      --phosphor2:#19c84a;
      --bg:#05060a;

      --roomShadow: rgba(0,0,0,.65);
      --roomGlow: rgba(43,255,99,.12);

      --bezel1:#0d1711;
      --bezel2:#070a08;

      --warn:#ffd54a;
      --err:#ff4d6d;

      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    html,body{height:100%; margin:0; background: var(--bg); color: var(--phosphor);}
    body{
      display:grid;
      place-items:center;
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 25% 10%, rgba(255,90,60,.10), transparent 60%),
        radial-gradient(1000px 700px at 80% 75%, rgba(43,255,99,.10), transparent 60%),
        linear-gradient(180deg, #070816, #04040a 55%, #020205);
    }

    /* ========= ROOM ========= */
    .room{
      width:min(1280px, 96vw);
      height:min(820px, 92vh);
      position:relative;
      border-radius:26px;
      overflow:hidden;
      box-shadow: 0 40px 160px rgba(0,0,0,.7);
      background:
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.25)),
        radial-gradient(950px 560px at 18% 20%, rgba(255,50,150,.07), transparent 60%),
        radial-gradient(900px 620px at 82% 42%, rgba(80,160,255,.07), transparent 60%),
        radial-gradient(1000px 700px at 50% 110%, rgba(0,0,0,.75), transparent 65%);
    }

    /* Optional: use your own real background image
       Add /assets/bedroom-bg.jpg and uncomment below.
    */
    /*
    .room::before{
      content:"";
      position:absolute; inset:0;
      background: url("assets/bedroom-bg.jpg") center/cover no-repeat;
      opacity:.38;
      filter: saturate(1.05) contrast(1.05);
      pointer-events:none;
    }
    */

    /* VHS / film tone overlay */
    .room::after{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(900px 560px at 55% 30%, rgba(0,0,0,.12), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.38)),
        repeating-linear-gradient( to bottom, rgba(255,255,255,.02) 0 1px, transparent 1px 6px);
      opacity:.55;
      pointer-events:none;
      mix-blend-mode:multiply;
    }

    /* Desk */
    .desk{
      position:absolute; left:0; right:0; bottom:0;
      height:240px;
      background:
        linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.65)),
        radial-gradient(700px 220px at 40% 40%, rgba(255,255,255,.05), transparent 65%),
        linear-gradient(90deg, rgba(255,255,255,.03), rgba(0,0,0,.20));
      box-shadow: inset 0 2px 0 rgba(255,255,255,.04);
    }

    /* ========= WALL DECOR: POSTERS ========= */
    .posterWall{
      position:absolute;
      left:34px; top:34px;
      width:520px;
      height:310px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:14px;
      z-index:2;
    }

    .poster{
      border-radius:16px;
      position:relative;
      background:
        linear-gradient(135deg, rgba(255,255,255,.10), rgba(0,0,0,.30)),
        radial-gradient(120px 120px at 30% 25%, rgba(255,213,74,.22), transparent 60%),
        radial-gradient(150px 150px at 70% 75%, rgba(43,255,99,.14), transparent 60%);
      box-shadow:
        0 14px 40px rgba(0,0,0,.55),
        inset 0 0 0 2px rgba(255,255,255,.06);
      transform: rotate(-1deg);
      overflow:hidden;
    }
    .poster:nth-child(2){ transform: rotate(1.5deg); }
    .poster:nth-child(3){ transform: rotate(-2.5deg); }

    .poster .label{
      position:absolute; inset:auto 14px 12px 14px;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.68);
      text-shadow: 0 2px 10px rgba(0,0,0,.6);
      user-select:none;
      line-height:1.15;
    }
    .poster .label b{ color: rgba(255,255,255,.86); }

    /* If you want real poster images:
       add assets/poster1.jpg, poster2.jpg, poster3.jpg and uncomment:
    */
    /*
    .poster.p1{ background: url("assets/poster1.jpg") center/cover no-repeat; }
    .poster.p2{ background: url("assets/poster2.jpg") center/cover no-repeat; }
    .poster.p3{ background: url("assets/poster3.jpg") center/cover no-repeat; }
    .poster .label{ display:none; }  // optional if image already has text
    */

    /* ========= BOOK STACK ========= */
    .books{
      position:absolute;
      left:64px;
      bottom:190px;
      width:260px;
      height:120px;
      z-index:3;
      display:flex;
      align-items:flex-end;
      gap:10px;
      transform: rotate(-2deg);
    }
    .book{
      width:54px;
      height:120px;
      border-radius:12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.35)),
        radial-gradient(40px 40px at 40% 30%, rgba(255,80,120,.25), transparent 60%);
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.06);
    }
    .book:nth-child(2){ height:108px; transform: translateY(6px); background:
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)),
      radial-gradient(40px 40px at 60% 40%, rgba(80,160,255,.22), transparent 60%);
    }
    .book:nth-child(3){ height:116px; transform: translateY(2px); background:
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)),
      radial-gradient(40px 40px at 50% 60%, rgba(43,255,99,.20), transparent 60%);
    }
    .book:nth-child(4){ height:104px; transform: translateY(10px); background:
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)),
      radial-gradient(40px 40px at 40% 50%, rgba(255,213,74,.22), transparent 60%);
    }

    .spine{
      position:absolute; inset:12px 10px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      user-select:none;
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      opacity:.9;
    }
    .spine small{ opacity:.7; letter-spacing:.12em; }

    /* ========= GAME CONSOLE + CARTS ========= */
    .console{
      position:absolute;
      right:64px;
      bottom:168px;
      width:320px;
      height:120px;
      border-radius:18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)),
        radial-gradient(180px 80px at 40% 20%, rgba(255,255,255,.06), transparent 60%);
      box-shadow: 0 18px 55px rgba(0,0,0,.60);
      border:1px solid rgba(255,255,255,.06);
      z-index:3;
    }
    .console::before{
      content:"";
      position:absolute; left:18px; right:18px; top:18px;
      height:14px;
      border-radius:10px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.05);
    }
    .console .btns{
      position:absolute; left:18px; bottom:18px;
      display:flex; gap:10px;
      opacity:.8;
    }
    .console .cbtn{
      width:52px; height:18px;
      border-radius:10px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.06);
    }

    .carts{
      position:absolute;
      right:78px;
      bottom:298px;
      display:flex;
      gap:12px;
      z-index:3;
      transform: rotate(2deg);
    }
    .cart{
      width:56px; height:70px;
      border-radius:14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.35)),
        radial-gradient(30px 30px at 50% 30%, rgba(43,255,99,.18), transparent 60%);
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 12px 40px rgba(0,0,0,.55);
      position:relative;
      overflow:hidden;
    }
    .cart::after{
      content:"";
      position:absolute; left:10px; right:10px; top:10px;
      height:18px;
      border-radius:10px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.05);
    }

    /* ========= BASKETBALL + HOOP ========= */
    .hoop{
      position:absolute;
      right:96px;
      top:78px;
      width:120px; height:120px;
      border-radius:22px;
      background:
        linear-gradient(135deg, rgba(255,255,255,.06), rgba(0,0,0,.28));
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 16px 50px rgba(0,0,0,.55);
      z-index:2;
    }
    .hoop::before{
      content:"";
      position:absolute; left:22px; right:22px; top:36px;
      height:10px;
      border-radius:12px;
      background: rgba(255,90,60,.55);
      box-shadow: 0 0 20px rgba(255,90,60,.25);
    }
    .hoop::after{
      content:"";
      position:absolute; left:34px; right:34px; top:52px;
      height:36px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      opacity:.45;
    }

    .basketball{
      position:absolute;
      left:340px;
      bottom:172px;
      width:74px; height:74px;
      border-radius:50%;
      background:
        radial-gradient(50px 50px at 30% 28%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(60px 60px at 70% 80%, rgba(0,0,0,.25), transparent 60%),
        linear-gradient(180deg, rgba(255,160,60,.9), rgba(165,70,20,.92));
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      z-index:3;
    }
    .basketball::before, .basketball::after{
      content:"";
      position:absolute; inset:8px;
      border-radius:50%;
      border:2px solid rgba(0,0,0,.18);
      opacity:.7;
    }
    .basketball::after{
      inset:0;
      border:none;
      background:
        linear-gradient(90deg, transparent 48%, rgba(0,0,0,.25) 49%, rgba(0,0,0,.25) 51%, transparent 52%),
        linear-gradient(0deg, transparent 48%, rgba(0,0,0,.25) 49%, rgba(0,0,0,.25) 51%, transparent 52%);
      border-radius:50%;
      opacity:.55;
    }

    /* ========= SCI-FI "WINDOW" ========= */
    .starWindow{
      position:absolute;
      left:620px;
      top:42px;
      width:220px; height:140px;
      border-radius:18px;
      background:
        radial-gradient(120px 90px at 30% 40%, rgba(80,160,255,.25), transparent 60%),
        radial-gradient(90px 70px at 70% 60%, rgba(255,50,150,.20), transparent 62%),
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.14) 0 1px, transparent 2px),
        radial-gradient(circle at 60% 20%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 70% 70%, rgba(255,255,255,.12) 0 1px, transparent 2px),
        radial-gradient(circle at 35% 75%, rgba(255,255,255,.09) 0 1px, transparent 2px),
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.68));
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 18px 55px rgba(0,0,0,.58);
      z-index:2;
      overflow:hidden;
    }
    .starWindow::after{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(circle at 40% 30%, rgba(255,255,255,.08), transparent 45%),
        repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,.04) 0 1px, transparent 1px 8px);
      opacity:.35;
      animation: drift 14s linear infinite;
    }
    @keyframes drift{
      0%{ transform: translate(0,0); }
      100%{ transform: translate(-30px, 18px); }
    }

    /* ========= COMPUTER RIG ========= */
    .rigWrap{
      position:absolute;
      left:50%;
      top:56%;
      transform: translate(-50%,-50%);
      width:min(980px, 92vw);
      height:min(640px, 78vh);
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      z-index:6;
    }

    .headerBar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-radius:18px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      color: rgba(255,255,255,.55);
      user-select:none;
    }
    .brand{
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:12px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(43,255,99,.22);
      box-shadow: 0 0 18px rgba(43,255,99,.2);
    }
    .actions{ display:flex; gap:10px; align-items:center; }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.70);
      padding:8px 10px;
      border-radius:12px;
      font: inherit;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      cursor:pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease;
    }
    .btn:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.16); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(43,255,99,.22);
      color: rgba(43,255,99,.92);
      box-shadow: 0 0 0 2px rgba(43,255,99,.08) inset;
    }

    .rig{
      height:100%;
      border-radius:24px;
      padding:18px;
      background: linear-gradient(180deg, rgba(13,23,17,.82), rgba(7,10,8,.92));
      box-shadow:
        0 35px 120px rgba(0,0,0,.75),
        inset 0 0 0 2px rgba(43,255,99,.10),
        inset 0 0 0 8px rgba(0,0,0,.28);
      position:relative;
    }

    .bezel{
      height:100%;
      border-radius:18px;
      background: linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.86));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.03);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow:hidden;
    }

    .screen{
      flex:1;
      border-radius:14px;
      background:
        radial-gradient(900px 600px at 50% 25%, rgba(43,255,99,.11), transparent 62%),
        linear-gradient(180deg, rgba(2,11,5,.98), rgba(0,0,0,.98));
      box-shadow:
        inset 0 0 0 1px rgba(43,255,99,.18),
        inset 0 0 40px rgba(0,0,0,.65);
      position:relative;
      overflow:hidden;
      animation: powerFlicker 1.1s linear 1;
    }
    @keyframes powerFlicker{
      0%{ filter: brightness(.2) contrast(1.2); }
      12%{ filter: brightness(.95) contrast(1.2); }
      18%{ filter: brightness(.35) contrast(1.2); }
      26%{ filter: brightness(1) contrast(1.2); }
      100%{ filter:none; }
    }

    /* CRT overlays */
    .screen::before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,.00) 0px,
          rgba(0,0,0,.00) 2px,
          rgba(0,0,0,.18) 3px
        );
      mix-blend-mode:multiply;
      pointer-events:none;
      opacity:.55;
    }
    .screen::after{
      content:"";
      position:absolute; inset:-50px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.05), transparent 45%),
        radial-gradient(circle at 75% 85%, rgba(255,255,255,.03), transparent 40%),
        repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,.02) 0 1px, transparent 1px 7px);
      filter: blur(.2px);
      pointer-events:none;
      opacity:.65;
    }

    .output{
      position:absolute; inset:0;
      padding:18px 18px 126px;
      overflow:auto;
      white-space:pre-wrap;
      line-height:1.35;
      text-shadow: 0 0 10px rgba(43,255,99,.28);
      scrollbar-width:thin;
      scrollbar-color: rgba(43,255,99,.25) transparent;
    }

    .output::-webkit-scrollbar{width:10px;}
    .output::-webkit-scrollbar-thumb{background: rgba(43,255,99,.18); border-radius:10px;}
    .output::-webkit-scrollbar-track{background: transparent;}

    /* separated bottom UI */
    .commandStrip{
      position:absolute;
      left:14px; right:14px; bottom:58px;
      height:54px;
      border-radius:14px;
      background: rgba(0,0,0,.52);
      border:1px solid rgba(43,255,99,.18);
      box-shadow:
        0 10px 28px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.03);
      display:flex;
      align-items:center;
      gap:12px;
      padding:0 12px;
    }

    .ps1{ color: rgba(43,255,99,.92); user-select:none; }
    input{
      flex:1;
      background: transparent;
      border:0;
      outline:none;
      color: var(--phosphor);
      font: inherit;
      font-size:15px;
      caret-color: var(--phosphor);
      text-shadow: 0 0 10px rgba(43,255,99,.28);
    }
    .cursor{
      width:10px; height:18px;
      background: rgba(43,255,99,.9);
      animation: blink 1.1s steps(1) infinite;
      box-shadow: 0 0 12px rgba(43,255,99,.4);
      border-radius:2px;
    }
    @keyframes blink { 50% { opacity:0; } }

    .statusbar{
      position:absolute; left:0; right:0; bottom:0;
      height:48px;
      background: linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.82));
      border-top: 1px solid rgba(43,255,99,.15);
      display:flex;
      align-items:center;
      padding:0 14px;
      gap:12px;
      user-select:none;
    }

    .led{
      width:10px; height:10px; border-radius:50%;
      background: rgba(43,255,99,.22);
      box-shadow: 0 0 12px rgba(43,255,99,.22);
    }
    .led.on{
      background: rgba(43,255,99,.95);
      box-shadow: 0 0 18px rgba(43,255,99,.8);
    }

    .hint{
      color: rgba(43,255,99,.65);
      font-size:12px;
      letter-spacing:.02em;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      flex:1;
    }

    .kbd{
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color: rgba(255,255,255,.25);
    }
    .keycap{
      border:1px solid rgba(255,255,255,.08);
      padding:4px 8px;
      border-radius:10px;
      background: rgba(255,255,255,.03);
    }

    .dim{ color: rgba(43,255,99,.55); }
    .warn{ color: var(--warn); text-shadow: 0 0 10px rgba(255,213,74,.25); }
    .err{ color: var(--err); text-shadow: 0 0 10px rgba(255,77,109,.25); }

    @media (max-width:820px){
      .posterWall{ display:none; }
      .starWindow{ display:none; }
      .hoop{ display:none; }
    }
    @media (max-width:520px){
      .kbd{ display:none; }
      .books, .console, .carts, .basketball{ display:none; }
      .rigWrap{ top:56%; }
    }
  </style>
</head>
<body>
  <div class="room">
    <div class="posterWall">
      <div class="poster p1">
        <div class="label"><b>SCI-FI NIGHT</b><br><span style="opacity:.75;">“IN SPACE, THE CURSOR BLINKS BACK.”</span></div>
      </div>
      <div class="poster p2">
        <div class="label"><b>ARCADE DREAMS</b><br><span style="opacity:.75;">HIGH SCORE OR BUST</span></div>
      </div>
      <div class="poster p3">
        <div class="label"><b>COURTSIDE ’86</b><br><span style="opacity:.75;">THE RIM REMEMBERS</span></div>
      </div>
    </div>

    <div class="starWindow" title="SCI-FI corner"></div>
    <div class="hoop" title="mini hoop"></div>

    <div class="books" title="books">
      <div class="book"><div class="spine">DUNE<small>HERBERT</small></div></div>
      <div class="book"><div class="spine">NEUROMANCER<small>GIBSON</small></div></div>
      <div class="book"><div class="spine">FOUNDATION<small>ASIMOV</small></div></div>
      <div class="book"><div class="spine">REBEL NOTES<small>VOL. I</small></div></div>
    </div>

    <div class="basketball" title="basketball"></div>

    <div class="carts" title="game cartridges">
      <div class="cart"></div>
      <div class="cart"></div>
      <div class="cart"></div>
    </div>

    <div class="console" title="game console">
      <div class="btns">
        <div class="cbtn"></div>
        <div class="cbtn"></div>
      </div>
    </div>

    <div class="desk"></div>

    <div class="rigWrap">
      <div class="headerBar">
        <div class="brand">
          <span class="dot"></span>
          <span>RL-80 Terminal • ROM v1.9</span>
        </div>
        <div class="actions">
          <button class="btn" id="btnReboot" title="Reboot (BOOT)">Reboot</button>
          <button class="btn primary" id="btnSkip" title="Skip intro and go to site">Skip</button>
        </div>
      </div>

      <div class="rig">
        <div class="bezel">
          <div class="screen" id="screen">
            <div class="output" id="out" aria-live="polite"></div>

            <div class="commandStrip" role="group" aria-label="terminal input">
              <div class="ps1" id="ps1">A:\></div>
              <input id="in" autocomplete="off" spellcheck="false" />
              <div class="cursor" aria-hidden="true"></div>
            </div>

            <div class="statusbar">
              <div class="led" id="led"></div>
              <div class="hint" id="hint">ENTER to type. Try: HELP, DIR, RUN REBEL, SKIP</div>
              <div class="kbd">
                <span class="keycap">SHIFT+BOOT</span>
                <span class="keycap">ESC</span>
                <span class="keycap">ENTER</span>
                <span class="keycap">↑</span>
                <span class="keycap">↓</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- rigWrap -->
  </div><!-- room -->

<script>
(() => {
  // ====== CONFIG YOU SHOULD EDIT ======
  const ROUTE_URL = "https://example.com"; // <-- set your real destination
  const ROUTE_DELAY_MS = 900;
  const BRAND = "THE REBEL LIBRARY";
  // ===================================

  const out = document.getElementById("out");
  const input = document.getElementById("in");
  const ps1 = document.getElementById("ps1");
  const hint = document.getElementById("hint");
  const led = document.getElementById("led");

  const btnSkip = document.getElementById("btnSkip");
  const btnReboot = document.getElementById("btnReboot");
  const screen = document.getElementById("screen");

  const state = {
    mode: "shell",     // shell | rebel
    step: 0,
    awaitingKey: null,
    history: [],
    histIdx: 0,
    cwd: "A:\\",
    booting: false
  };

  const sleep = (ms) => new Promise(r => setTimeout(r, ms));
  const scrollBottom = () => { out.scrollTop = out.scrollHeight; };

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  async function typeLine(text="", cls=""){
    const line = document.createElement("div");
    if (cls) line.className = cls;
    out.appendChild(line);
    for (const ch of text){
      line.textContent += ch;
      scrollBottom();
      await sleep(4);
    }
    scrollBottom();
  }

  function instantLine(html){
    const line = document.createElement("div");
    line.innerHTML = html;
    out.appendChild(line);
    scrollBottom();
  }

  function setHint(t){ hint.textContent = t; }
  function setLed(on){ led.classList.toggle("on", !!on); }

  function prompt(){
    ps1.textContent = state.cwd + ">";
    input.value = "";
    input.focus();
  }

  function normalize(cmd){
    return cmd.trim().replace(/\s+/g," ");
  }

  function routeNow(){
    window.location.replace(ROUTE_URL);
  }

  async function routeWithFlavor(){
    setLed(true);
    setHint("Routing to site...");
    await typeLine("");
    await typeLine("CONNECTING TO MODERN STACKS...", "dim");
    await sleep(ROUTE_DELAY_MS);
    routeNow();
  }

  // Fake filesystem
  const files = {
    "README.TXT": [
      "RL-80 PERSONAL MICROCOMPUTER",
      "---------------------------",
      "Type HELP for commands.",
      "To begin: RUN REBEL",
      "To bypass: SKIP",
      "",
      "Some knowledge prefers shadows."
    ],
    "REBEL.TXT": [
      "THE REBEL LIBRARY",
      "A collection of forbidden footnotes,",
      "misfiled myths, and brave little truths.",
      "",
      "To enter: RUN REBEL"
    ]
  };

  function dirListing(){
    return [
      " Volume in drive A is RL80_BOOT",
      " Volume Serial Number is 19C0-1984",
      "",
      " Directory of A:\\",
      "",
      "README   TXT     1,024  12-31-85  12:00a",
      "REBEL    TXT     2,048  12-31-85  12:00a",
      "REBEL    EXE    34,816  12-31-85  12:00a",
      "",
      "     3 File(s)         37,888 bytes",
      "     0 Dir(s)          81,920 bytes free"
    ];
  }

  async function bootSequence({skipIfShift=false} = {}){
    if (state.booting) return;
    state.booting = true;

    out.innerHTML = "";
    setLed(true);
    setHint("Booting... (Hold SHIFT to skip)");

    await typeLine("RL-80 BIOS v1.9 (C) 1985 REBELWORKS", "dim");
    await sleep(120);

    if (skipIfShift && window.__RL_SHIFT_DOWN){
      await typeLine("SHIFT DETECTED: FAST-BOOT ENABLED", "warn");
      await sleep(250);
      await routeWithFlavor();
      return;
    }

    await typeLine("64K RAM SYSTEM  64K RAM FREE", "dim");
    await sleep(120);
    await typeLine("Detecting drives... A: OK   B: NOT PRESENT", "dim");
    await sleep(120);
    await typeLine("Loading COMMAND.COM", "dim");
    await sleep(180);

    await typeLine("");
    await typeLine("Welcome to RL-DOS 2.1");
    await typeLine("Type HELP for a list of commands.");
    await typeLine("");

    setLed(false);
    setHint("Try: DIR | TYPE REBEL.TXT | RUN REBEL | SKIP");
    state.mode = "shell";
    state.step = 0;
    state.awaitingKey = null;
    state.booting = false;
    prompt();
  }

  async function handleShell(cmdRaw){
    const cmd = normalize(cmdRaw);
    if (!cmd) return;

    state.history.push(cmd);
    state.histIdx = state.history.length;

    instantLine(`<span class="dim">${escapeHtml(state.cwd)}&gt;</span> ${escapeHtml(cmd)}`);

    const [head, ...rest] = cmd.split(" ");
    const arg = rest.join(" ").toUpperCase();

    switch (head.toUpperCase()){
      case "HELP":
        await typeLine("Commands:", "dim");
        await typeLine("  HELP               show this help", "dim");
        await typeLine("  DIR                list files", "dim");
        await typeLine("  TYPE <FILE>        print a file", "dim");
        await typeLine("  RUN REBEL          start The Rebel Library", "dim");
        await typeLine("  SKIP               go straight to the site", "dim");
        await typeLine("  CLS                clear screen", "dim");
        await typeLine("  BOOT               reboot", "dim");
        setHint("Try: RUN REBEL (or SKIP)");
        break;

      case "DIR":
        for (const l of dirListing()) await typeLine(l, "dim");
        setHint("Try: RUN REBEL or SKIP");
        break;

      case "TYPE":
        if (!arg){ await typeLine("TYPE requires a filename.", "err"); break; }
        if (!files[arg]){
          await typeLine(`File not found: ${arg}`, "err");
          break;
        }
        for (const l of files[arg]) await typeLine(l);
        setHint("If you’re ready: RUN REBEL");
        break;

      case "RUN":
        if (arg !== "REBEL" && arg !== "REBEL.EXE"){
          await typeLine("Bad command or file name.", "err");
          break;
        }
        await startRebel();
        break;

      case "SKIP":
        await routeWithFlavor();
        break;

      case "CLS":
        out.innerHTML = "";
        setHint("Clean slate. RUN REBEL or SKIP");
        break;

      case "BOOT":
        state.booting = false;
        await bootSequence({skipIfShift:true});
        break;

      default:
        await typeLine("Bad command or file name.", "err");
        setHint("Try HELP");
    }
  }

  async function startRebel(){
    state.mode = "rebel";
    state.step = 0;
    state.awaitingKey = "PASS";
    setLed(true);
    setHint("THE REBEL LIBRARY loading...");
    await typeLine("");
    await typeLine("Loading REBEL.EXE ...", "dim");
    await sleep(250);
    await typeLine("Initializing clandestine stacks...", "dim");
    await sleep(250);
    await typeLine("");
    setLed(false);

    await typeLine(`${BRAND}`, "warn");
    await typeLine("================================", "dim");
    await typeLine("");
    await typeLine("A cursor blinks like it knows your name.");
    await typeLine("Password required.");
    await typeLine("");
    await typeLine("Hint: It's written on the disk label.", "dim");
    setHint("Enter password (or type SKIP):");
  }

  function validateRebel(step, answer){
    const a = normalize(answer).toUpperCase();
    if (a === "SKIP") return { ok:true, skip:true };

    if (step === 0){
      if (a === "RL80" || a === "RL-80") return {ok:true};
      return {ok:false, msg:"ACCESS DENIED. (Hint: try RL80)"};
    }
    if (step === 1){
      if (["B","BINARY"].includes(a)) return {ok:true};
      return {ok:false, msg:"That door is locked. The humming prefers Binary (B)."};
    }
    if (step === 2){
      if (["LANGUAGE","A LANGUAGE","CODE","A CODE"].includes(a)) return {ok:true};
      return {ok:false, msg:"Not quite. Think: humans speak it. machines read it."};
    }
    if (step === 3){
      if (a === "1985") return {ok:true};
      return {ok:false, msg:"Incorrect. Check the file dates. This box lives in 1985."};
    }
    if (step === 4){
      if (a === "DIAL") return {ok:true};
      return {ok:false, msg:"The modem just stares. Type DIAL."};
    }
    return {ok:true};
  }

  async function rebelAdvance(answer){
    const verdict = validateRebel(state.step, answer);
    if (verdict.skip){
      instantLine(`<span class="warn">SKIP ACCEPTED.</span>`);
      await routeWithFlavor();
      return;
    }
    if (!verdict.ok){
      await typeLine(verdict.msg, "err");
      setHint("Try again (or SKIP). ESC to exit.");
      return;
    }

    state.step++;

    if (state.step === 1){
      await typeLine("");
      await typeLine("ACCESS GRANTED.", "warn");
      await typeLine("Welcome, Archivist.");
      await typeLine("");
      await typeLine("Puzzle 1: Choose a door: [A]lgebra, [B]inary, [C]rypt.");
      state.awaitingKey = "DOOR";
      setHint("Type A, B, or C (or SKIP):");
      return;
    }

    if (state.step === 2){
      await typeLine("");
      await typeLine("You enter a hall of humming modems.");
      await typeLine("A bulletin board scrolls a riddle:");
      await typeLine("");
      await typeLine("  'I speak in 1s and 0s, but I am not a machine.'", "dim");
      await typeLine("  'Name me.'", "dim");
      state.awaitingKey = "RIDDLE";
      setHint("Your answer (or SKIP):");
      return;
    }

    if (state.step === 3){
      await typeLine("");
      await typeLine("Correct. The hall approves with a relay-click.");
      await typeLine("");
      await typeLine("Puzzle 2: A file cabinet asks for a 4-digit code.");
      await typeLine("Hint: The year this machine thinks it is.");
      state.awaitingKey = "CODE";
      setHint("Enter 4 digits (or SKIP):");
      return;
    }

    if (state.step === 4){
      await typeLine("");
      await typeLine("CABINET UNLOCKED.", "warn");
      await typeLine("Inside: a map made of margins.");
      await typeLine("It points to a single command:");
      await typeLine("");
      await typeLine("  DIAL", "dim");
      await typeLine("");
      await typeLine("Type DIAL to connect. (ESC to exit, SKIP to bypass)");
      state.awaitingKey = "DIAL";
      setHint("Type DIAL (or SKIP):");
      return;
    }

    if (state.step === 5){
      await typeLine("");
      await typeLine("ATDT 9,1,555-REBL", "dim");
      await sleep(250);
      await typeLine("CONNECT 2400", "warn");
      await sleep(300);
      await typeLine("");
      await typeLine("Transferring you to the modern stacks...", "dim");
      await sleep(700);
      await routeWithFlavor();
      return;
    }
  }

  input.addEventListener("keydown", async (e) => {
    if (state.mode === "shell"){
      if (e.key === "ArrowUp"){
        e.preventDefault();
        state.histIdx = Math.max(0, state.histIdx - 1);
        input.value = state.history[state.histIdx] ?? "";
        return;
      }
      if (e.key === "ArrowDown"){
        e.preventDefault();
        state.histIdx = Math.min(state.history.length, state.histIdx + 1);
        input.value = state.history[state.histIdx] ?? "";
        return;
      }
    }

    if (e.key === "Escape"){
      if (state.mode === "rebel"){
        instantLine(`<span class="dim">[ESC]</span> Returning to DOS...`);
        state.mode = "shell";
        state.awaitingKey = null;
        setLed(false);
        setHint("Back at DOS. Try: RUN REBEL or SKIP");
        prompt();
      }
      return;
    }

    if (e.key !== "Enter") return;
    e.preventDefault();

    const value = input.value;
    if (!normalize(value)){
      setHint("Type something. (HELP / RUN REBEL / SKIP)");
      return;
    }

    if (state.mode === "shell"){
      await handleShell(value);
      prompt();
      return;
    }

    instantLine(`<span class="dim">REBEL&gt;</span> ${escapeHtml(value)}`);
    input.value = "";
    await rebelAdvance(value);
  });

  // Click to focus
  screen.addEventListener("mousedown", () => input.focus());

  // Buttons
  btnSkip.addEventListener("click", () => routeWithFlavor());
  btnReboot.addEventListener("click", () => bootSequence({skipIfShift:true}));

  // SHIFT-to-skip during boot
  window.__RL_SHIFT_DOWN = false;
  window.addEventListener("keydown", (e) => { if (e.key === "Shift") window.__RL_SHIFT_DOWN = true; });
  window.addEventListener("keyup", (e) => { if (e.key === "Shift") window.__RL_SHIFT_DOWN = false; });

  // Boot
  bootSequence({skipIfShift:true});
})();
</script>
</body>
</html>
